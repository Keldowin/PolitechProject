from bot import *
#locale.setlocale(locale.LC_TIME, 'ru_RU')


def cheak_registration(userid : int): #–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞—Ä–µ–≥–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ –Ω–µ—Ç
    cheak = sql.execute(f"SELECT `user_id` FROM `Users` WHERE `user_id` = {userid}")
    return bool(cheak.fetchall())

def user_registration(userid : int): #–†–µ–≥–µ—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    sql.execute(f"INSERT INTO `Users` (User_id) VALUES ({userid})")
    db.commit()

def get_user(userid : int):
    if cheak_registration(userid):
        user = sql.execute(f"SELECT `user_id` FROM `Users` WHERE `user_id` = {userid}")
        return user.fetchall()
    else:
        return False

def get_users():
    users = sql.execute(f"SELECT `user_id` FROM `Users`")
    if users:
        users = users.fetchall()
        return users
    else:
        return False
    
def get_termin(id : int):
    termin = sql.execute(f"SELECT `Termens_short`,`Termens_full`,`Termens_category` FROM `Termens` WHERE `id` = {id}")
    if termin:
        termin = termin.fetchall()
        return termin
    else:
        print('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞')
        return False

def get_termin_by_category(id : int, category : int):
    termin = sql.execute(f"SELECT `Termens_short`,`Termens_full`,`Termens_category` FROM `Termens` WHERE `id` = {id} AND `Termens_category` = {category}")
    if termin:
        termin = termin.fetchall()
        return termin
    else:
        print('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞')
        return False

async def generate_test(callback_query, TerminCategory):
    TerminsCount = sql.execute('SELECT `id` FROM `Termens`')
    TerminsCount = len(TerminsCount.fetchall())
    TerminRand = randint(0, TerminsCount)
    #–ü–æ–ª—É—á–∞–µ–º —Ä–∞–Ω–¥–æ–º–Ω—ã–π —Ç–µ—Ä–º–∏–Ω
    Termin = get_termin_by_category(TerminRand, TerminCategory)
    if Termin:
        keyboard = InlineKeyboardMarkup()
        keyboard.add(InlineKeyboardButton('–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Ä–º–∏–Ω ‚û°',callback_data='NextTermin'),InlineKeyboardButton('–ü–æ–∫–∞–∑–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ üìñ',callback_data='FullTermin_'+str(TerminRand)))

        TerminOutputMode = randint(1, 4) #–ü–æ–ª—É—á–∞–µ–º —Ä–µ–∂–∏–º –≤—ã–≤–æ–¥–∞ –≤–æ–ø—Ä–æ—Å–≤ (1 - T.F.F / 2 - F.T.F / 3 - F.F.T)
        BadTermins = sql.execute(f'SELECT `Termens_full` FROM Termens WHERE `Termens_category` = {TerminCategory} ORDER BY RANDOM() LIMIT 2;') #–ó–∞–ø—Ä–æ—Å –Ω–∞ 2 –ø–ª–æ—Ö–∏—Ö –æ—Ç–≤–µ—Ç–∞
        BadTermins = BadTermins.fetchall()

        ShortTermin_full = Termin[0][1].capitalize()
        ShortTermin_bad = BadTermins[0][0].capitalize()
        ShortTermin_bad2 = BadTermins[1][0].capitalize()

        ShortTermin_full
        #–°—Ç—Ä–æ–∏–º –æ—Ç–≤–µ—Ç—ã
        if TerminOutputMode == 1:
            TerminMode = f"1. {ShortTermin_full}\n\n2. {ShortTermin_bad}\n\n3. {ShortTermin_bad2}"
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 1.",callback_data='TrueAnswer_'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 2.",callback_data='FalseAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 3.",callback_data='FalseAnswer'+str(TerminCategory)))
        elif TerminOutputMode == 2:
            TerminMode = f"1. {ShortTermin_bad}\n\n2. {ShortTermin_full}\n\n3. {ShortTermin_bad2}"
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 1.",callback_data='FalseAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 2.",callback_data='TrueAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 3.",callback_data='FalseAnswer'+str(TerminCategory)))
        elif TerminOutputMode == 3:
            TerminMode = f"1. {ShortTermin_bad}\n\n2. {ShortTermin_bad2}\n\n3. {ShortTermin_full}"
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 1.",callback_data='FalseAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 2.",callback_data='FalseAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 3.",callback_data='TrueAnswer'+str(TerminCategory)))
        elif TerminOutputMode == 4:
            TerminMode = f"1. {ShortTermin_bad2}\n\n2. {ShortTermin_bad}\n\n3. {ShortTermin_full}"
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 1.",callback_data='FalseAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 2.",callback_data='FalseAnswer'+str(TerminCategory)))
            keyboard.add(InlineKeyboardButton("–í–∞—Ä–∏–∞–Ω—Ç 3.",callback_data='TrueAnswer'+str(TerminCategory)))

        keyboard.add(InlineKeyboardButton('‚¨Ö –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é',callback_data='Menu'))
        TerminText = f"–í—ã–±–µ—Ä–∏—Ç–µ <u><b>–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</b></u> –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ—Ä–º–∏–Ω:\n<b>{Termin[0][0]}</b>\n\n{TerminMode}"
        await callback_query.message.edit_text(text=TerminText,reply_markup=keyboard,parse_mode='HTML')